<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <style>
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #container {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="container"></div>

    <!-- Use CDN for loader.js -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@latest/min/vs/loader.js"></script>
    <script>
        window.chrome?.webview?.addEventListener('message', event => {
            // You can later respond here if needed
        });

        require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@latest/min/vs' } });

        require(["vs/editor/editor.main"], function () {
            monaco.editor.defineTheme('custom-dark', {
                base: 'vs-dark',
                inherit: true,
                rules: [],
                colors: {
                    'editor.background': '#111111',
                }
            });

            var editor = monaco.editor.create(document.getElementById("container"), {
                value: '',
                language: 'lua',
                theme: 'custom-dark',
                dragAndDrop: true,
                links: false,
                cursorBlinking: 'smooth',
                cursorSmoothCaretAnimation: 'on',
                scrollBeyondLastLine: false,
                minimap: {
                    enabled: true,
                },
                showFoldingControls: "always",
                smoothScrolling: true,
            });

            // Enable auto-indentation for Lua
            monaco.languages.setLanguageConfiguration('lua', {
                autoClosingPairs: [
                    { open: '{', close: '}' },
                    { open: '[', close: ']' },
                    { open: '(', close: ')' },
                    { open: '"', close: '"', notIn: ['string'] },
                    { open: "'", close: "'", notIn: ['string'] },
                ],
                surroundingPairs: [
                    { open: '{', close: '}' },
                    { open: '[', close: ']' },
                    { open: '(', close: ')' },
                    { open: '"', close: '"' },
                    { open: "'", close: "'" },
                ],
                indentationRules: {
                    increaseIndentPattern: /^\s*(function|then|do|\{|\[).*$/,
                    decreaseIndentPattern: /^\s*(end|elseif|else|\}|\]).*$/
                }
            });

            window.onresize = function () {
                editor.layout();
            };

            window.getValue = function () {
                return editor.getValue();
            };

            window.setValue = function (value) {
                editor.setValue(value);
            };
        });
    </script>
</body>
</html>
